const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CiUbhgSH.js","./BgSmK28P.js","./entry.Ba-_uvXy.css"])))=>i.map(i=>d[i]);
import{ab as w,_ as g,ac as u,ad as l,ae as p}from"./BgSmK28P.js";async function S(n,a="gzip"){var c;const e=Uint8Array.from(atob(n),d=>d.charCodeAt(0)),r=(c=new Response(new Blob([e])).body)==null?void 0:c.pipeThrough(new DecompressionStream(a)),s=await new Response(r).text();return JSON.parse(s)}function f(n,a){const e=b(n),t={...a};for(const r in t)e[r]==="json"&&t[r]&&t[r]!=="undefined"&&(t[r]=JSON.parse(t[r])),e[r]==="boolean"&&t[r]!=="undefined"&&(t[r]=!!t[r]);for(const r in t)t[r]==="NULL"&&(t[r]=void 0);return t}function b(n){const a=n.match(/FROM\s+(\w+)/);if(!a)return{};const e=w[h(a[1])];return(e==null?void 0:e.fields)||{}}function h(n){return n.replace(/^_content_/,"")}let o;const m={},i={};function R(n){async function a(e){return o||(i._=i._||_(),o=await i._,Reflect.deleteProperty(i,"_")),m[String(e)]||(i[String(e)]=i[String(e)]||y(e),await i[String(e)],m[String(e)]="loaded",Reflect.deleteProperty(i,String(e))),o}return{all:async(e,t)=>(await a(n),o.exec({sql:e,bind:t,rowMode:"object",returnValue:"resultRows"}).map(r=>f(e,r))),first:async(e,t)=>(await a(n),f(e,o.exec({sql:e,bind:t,rowMode:"object",returnValue:"resultRows"}).shift())),exec:async(e,t)=>{await a(n),await o.exec({sql:e,bind:t})}}}async function _(){if(!o){const n=await g(()=>import("./CiUbhgSH.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.default);globalThis.sqlite3ApiConfig={silent:!0,debug:(...e)=>console.debug(...e),warn:(...e)=>{String(e[0]).includes("OPFS sqlite3_vfs")||console.warn(...e)},error:(...e)=>console.error(...e),log:(...e)=>console.log(...e)};const a=await n();o=new a.oo1.DB}return o}async function y(n){if(window.sessionStorage.getItem("previewToken"))return o;let a=null;const e=`checksum_${n}`,t=`collection_${n}`;let r="matched";try{const s=o.exec({sql:`SELECT * FROM ${u.info} where id = '${e}'`,rowMode:"object",returnValue:"resultRows"}).shift();(s==null?void 0:s.version)!==l[String(n)]&&(r="mismatch")}catch{r="missing"}if(r!=="matched"){if(window.localStorage.getItem(`content_${e}`)===l[String(n)]&&(a=window.localStorage.getItem(`content_${t}`)),!a){a=await p(void 0,String(n));try{window.localStorage.setItem(`content_${e}`,l[String(n)]),window.localStorage.setItem(`content_${t}`,a)}catch(c){console.error("Database integrity check failed, rebuilding database",c)}}const s=await S(a);await o.exec({sql:`DROP TABLE IF EXISTS ${u[String(n)]}`}),r==="mismatch"&&await o.exec({sql:`DELETE FROM ${u.info} WHERE id = '${e}'`});for(const c of s)try{await o.exec(c)}catch(d){console.error("Error executing command",d)}}return o}export{R as loadDatabaseAdapter};
